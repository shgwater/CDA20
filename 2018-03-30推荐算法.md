# 0330推荐算法

## 一 推荐系统基础

### 1. 什么是推荐系统

#### 推荐系统是根据用户历史行为和当前所处的环境，根据信息的特点来决定推荐最合适的内容和商品。

#### 是用来解决信息过载问题的一箱工具。

#### 发展阶段：分类目录、搜索引擎、推荐系统

#### 推荐系统和搜索引擎一样可以看作是一个信息检索的系统，区别是搜索是主动式的，推荐系统是被动出现的。

#### 总体 通过用户分群精准营销 到群体 通过个性化推荐 到个体。

### 2. 搜索 VS 推荐
从搜索到推荐是大势所趋，个性化成为潮流。

### 3. 推荐系统分类

#### 基于应用领域

- 电子商务推荐
- 社交好友推荐
- 信息内容推荐
- 搜索引擎推荐

#### 基于设计思想

- 基于协同过滤
- 基于内容
- 基于知识
- 混合推荐

#### 基于使用数据

- 用户行为数据
- 用户标签数据
- 社交网络数据
- 上下文信息

### 4. 推荐算法分类

#### 基于用户需求的推荐
机器学习分类器模型

根据用户的属性、行为数据对客户的需求进行建模，预测客户行为。

#### 基于购物篮的推荐
算法：关联规则

物品被同事购买的模式反映了顾客的需求模式


#### 基于相似性的推荐
算法：协同过滤

#### 基于内容的评价
算法：规则或矩阵分解

### 5. 推荐系统的评价指标

#### 第一层次：基于数据的指标

- 预测评分准确度、预测评分关联、分类准确度、排序准确度
- 准确率、召回率、准确率提高率、召回率提高率、F1指标和AUC值

#### 第二层次：商业应用上的关键表现指标

- 用户收到推荐影响后的转化率、客单价、购买品类数和活跃度等的变化。

#### 第三层次：用户真实的体验

#### 什么事正确率和召回率

两者的取值在0到1之间，数值越接近1，查准率或查全率就越高。

|用户喜欢 | 推荐| 不推荐 |
|---|---|---|
| 喜欢 | N(tp) | N(tn)|
|不喜欢 | N(fp) | N(fn)|

准确率：
Pu = Ntp/(Ntp+Nfp)
召回率：
Ru = Ntp/(Ntp+Ntn)

由此可见，正确率是评估捕获的成果中目标成果所占得比例；召回率，顾名思义，就是从关注领域中，召回目标类别的比例；而F值，则是综合这二者指标的评估指标，用于综合反映整体的指标。
当然希望检索结果Precision越高越好，同时Recall也越高越好，但事实上这两者在某些情况下有矛盾的。比如极端情况下，我们只搜索出了一个结果，且是准确的，那么Precision就是100%，但是Recall就很低；而如果我们把所有结果都返回，那么比如Recall是100%，但是Precision就会很低。因此在不同的场合中需要自己判断希望Precision比较高或是Recall比较高。

##### 正确率=提取处的正确信息条数/提取出的信息条数

##### 召回率=提取处的正确信息条数/样本的信息条数

##### F值=正确率*召回率*2/(正确率+召回率)

F值即为正确率和召回率的调和平均值。

#### 推荐系统层次：
推荐准确-->挖掘长尾-->覆盖多种类别-->超出用户期待

## 二 购物篮分析与关联系统

### 1. 什么是购物篮分析

#### 定义
单个客户一次购买商品的总和称为一个购物篮

#### 思想
分析商品与商品之间的关联（啤酒和尿布）

#### 算法
- 不考虑购物顺序：关联规则。
- 考虑购物顺序：序贯模型。

#### 应用
- 超市画家布局：互补品与互斥品。
- 套餐设计和捆绑销售

### 2. 关联规则：概念

#### 概念：
`!$I=(i_1,i_2,...,i_n)$`是n个不同项目的集合，`!$i_k(k=1,2,3,...)$`称为一个项目（item）

#### 项集：
项目的集合称为项目合集（itemset），简称为项集，其元素的个数称为项集的长度，长度为k的项集称为K-项集（k-itemset）

#### 交易：
每笔交易T（Transaction）是项集 I 上的一个自己，即T包含于I。`!$T\subseteq I$`

#### 交易集：
交易的全体构成了交易记录集D,简称交易集D，交易集D中包含记忆的个数为|D|。

#### 关联规则：
设A,B为两个项集，则关联规则如下蕴含式。
A,B为两项集，是最大项集的两个子集，并且A和B没有交集。用 A=>B 表示。

#### 支持度：
是两件商品（`!$A \cap B$`)在总销售笔数（N）中出现的概率，即A与B同事被购买的概率。
支持度表示规则是否普遍。
`!$Support(A \cap B)=\frac {Freq(A \cap B)} N$`

#### 置信度：
置信度是一种条件概率，表示购买力A后在购买B的概率。
`!$Confidence=\frac {Freq(A\cap B)} {Freq(A)}$`

支持度和置信度的例子在pdf 文件 page21


#### 理解支持度和置信度

食堂卖饭，1000份打饭记录中，买米饭的有800人次，买牛肉的有600人次，两个共同买的有400人次。
那么可以得出对于规则(牛肉->米饭)
支持度=P(牛肉&米饭)=400/1000=0.40
置信度=P(米饭|牛肉)=400/600=0.67
置信度和支持度都很高，但是给买牛肉的人推荐米饭有意义吗？
如果直接计算无任何条件下用户购买米饭的概率:
P(米饭)=800/1000=0.8
定义：
提升度= 置信度/无条件概率=0.67/0.8


#### 提升度：
置信度除以右边物品的概率。
`!$Lift=\frac {confidence(A=>B)} {Support(B) = \frac {P(A\sebseteq B)} {P(A)P(B)}$`
只有提升度大于1才说明关联规则真正有效。一般要大于3。
A到B的提升度和B到A的提升度是一样的

### 3.关联规则挖掘

#### 定义
给定一个交易数据集T，找出其中所有吃尺度和置信度满足一定条件的关联规则。

#### 项集最小支持度
发现关联规则要求项集必须满足的最小支持阈值，Minimum Support 记作supmin

#### 频繁项集
支持度大于或者等于supmin的项集。

#### k-频繁项集
如果K-项集满足supmin，称为 K-频繁项集，记作L_k

#### 关联规则的最小支持度
衡量频繁项集的最小支持度，它用于衡量规则需要满足的最低重要性。

客户分群
逻辑回归
线性回归
决策树

#### 关联规则的最小置信度
confmin 他表示关联规则需要满足的最低可靠性。、

#### 强关联规则
如果关联规则满足支持度大于最小支持度，置信度大于最小置信度则称为强关联规则。
- 支持度大于最小支持度，
- 置信度大于最小置信度。

### 4.Apriori算法

#### Apriori算法

关联规则挖掘所花费的时间主要是在生成频繁项集上，因为找出的频繁项集往往不会很多，利用频繁项集生成规则也就不会花太多的时间

1. Apriori算法利用频繁集的两个特性，过滤了很多无关的集合，效率提高不少

2. Apriori算法是一个候选消除算法，每一次消除都需要扫描一次所有数据记录，造成整个算法在面临大数据集时显得无能为力。每次生成频繁项集时都要进行全表扫描

##### 1）生成频繁项集
找出满足最小支持度的项集，这些称为频繁项集。

##### 2） 生成规则
在上一步产生的频繁项集的基础上生成最小置信度的规则，产生的规则称为强规则。

关联规则挖掘所花费的时间主要是在生成频繁项集上，因为找出的频繁项集往往不会很多，利用频繁项集生成规则也就不会花太多的时间

##### Apriori基于以下两条核心原理生成频繁项集
- 如果某各项技术频繁的，那么他的所有自己也是频繁的。
- 若子集不是频繁的，则所有包含它的项集都是不频繁的。

例如香蕉和牛奶是频繁的，单独拆开看也都是频繁的。
香蕉是不频繁的，所有包含香蕉的项集也都是不频繁的。


#### 第一步：
所有单独的项都是候选项集 C1，任何支持度比给定的最小支持度小的项都将从候选项集C1中剔除，成频繁 1-项集 L1

#### 连接步：
两个L1通过自连接形成具有两个想的候选项集C2

#### 剪枝步：
再次扫描所有C2，保留比预先给定的最小支持度大的候选项，形成频繁2-项集L2。
进行到后面的剪枝步时，使用算法的核心原理，**可以去掉所有的包含非频繁项集的项集。**

#### 重复连接步和剪枝步

#### 基于频繁项集生成关联规则

#### 再分别计算关联规则的提升度。

### 5. FpGrowth算法，新算法

### 6. 关联规则代码实战

#### 使用arules包 可视化 arulesViz包

## 三 相似性推荐与协同过滤

## 四 基于内容的推荐

## 五 问题与案例
