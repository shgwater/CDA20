---
title: 2018-3-29时间序列分析案例
tags: R实例,时间序列,MARKDOWN
grammar_cjkRuby: true
---
# 时间序列分析

## 一 时间序列简介

### 1、时间序列构成及分解

#### 长期趋势变动

#### 季节性变动

#### 循环性变动

#### 不规则变动

### 2、时间序列构成的分解

#### 原始序列

#### 趋势

#### 随机

#### 循环或季节性

### 3.时间序列的表达

### 4、时间序列特征捕捉

#### 1、序列相关性

<!--Note-->
###### 序列相关性：
当期的序列值和前期某个或某些序列值线性相关
- 自相关系数（ACF）
 - 滞后k阶自相关系数
- 偏自相关系数 PACF
<!--/Note-->

##### 自相关性

##### 偏自相关性

#### 2.趋势性

整体上呈现单调性
ARMA模型是平稳的时间序列模型，再见没钱需去掉。

### 5.时间序列的平稳性

#### 1.定义

- 如果一个事件概率分布与时间t无关，则称为该序列为严平稳时间序列。
- 通常情况下，时间序列的概率分布很难获取与计算，实际中讨论的平稳时间序列主要是指款平稳

## 二 时间序列模型

### 1、最简单的时间序列-白噪声

#### 白噪声

- 序列无规律可循，在均值处反复真的那个。
- 无趋势性
- 相关性的捕捉就是要搞清楚到底之前那几期的值会影响当前值。
- 通过查看自相关函数ACF和便自相关系数PACF识别期数。


#### 时间序列图例

- 现实中大部分数据都会有趋势和季节性。
- 绝大部分序列模型都要去掉趋势和季节性。

### 2.平稳时间序列模型

注意，p和q值需要在 -1到1 之间。


#### 1、自回归模型
(Autoregressive Model,AR)

AR(p)
X_t=\beta_1 X_{t-1}+...+\beta_p X_{t-p}+e_t~WN(0,\theta^2)
当前时刻的时序值可有过去值得线性组合加上一个白噪声。

目的就是要搞清楚过去几期的历史值会影响当前值

模型特征：
- 趋势性： 无
- 相关性：有
- 随机性：有

## 如何识别自回归模型
通过查看偏自相关系数
- PACF显示出剧烈的下降，并截断在P阶，而ACF呈指数下降趋势。
- PACF截尾的阶数即为AR模型的阶数。



##### AR1模型

一阶自回归模型是最简单的自回归模型

X_t=\beta_1X_{t-1}+e_t



##### 如何识别自回归模型

###### 1.PACF显示出剧烈的下降，并截断在P阶，
而ACF呈指数下降趋势

###### 2.PACF截尾的阶数即为AR模型的阶数。

##### 模型特征

###### 趋势性：无

###### 相关性：有

###### 随机性：有

#### 2.移动平均模型
(Moving Average Model,MA)

`!$MA(q)X_t=e_1+\beta_1e_{t-1}+\beta_2e_{t-2}+...+\beta_qe_{t-q}$`
序列当前时刻的时序值是过去q阶白噪声的线性组合。

建模的目的在于找出过去几期的白噪声影响了当前值。

模型特征
- 趋势性：无
- 相关性：有
- 随机性：有

##### MA(1)模型

`!$X_t=e_t+\beta_1e_t-1$`


##### 如何识别一个MA的阶数q

###### 1、如果ACF显示出一个剧烈的下降（q阶截尾）
并且PACF呈指数下降趋势，即为移动平均模型

###### 2.ACF截尾阶数即为MA模型阶数。

##### 模型特征

###### 趋势性：无

###### 相关性：有

###### 随机性：有

#### 3. 自回归移动平均模型
(Autoregressive and 
Moving Average Model,ARMA)

ARMA(p,q)模型就是AR(p)模型与MA(q)模型的组合。

##### ARMA(1,1)模型




##### 如何识别自回归移动平均模型的p和q

###### 1、由于ACF与PACF均呈现指数下降，判断阶数需要靠不断尝试。

###### 2.在不同模型的尝试中，通过信息准则选择最优模型。

###### 3.常用信息准则：AIC BIC等，
`!$AIC=-2ln(L)+2k  BIC=-2ln(L)+ln(n)*k $`
L为对数似然函数值，RSS为残差平方和。
`!$L=-\frac 2 n [1+ln(2II)+ln(RSS/n)]$`
##### 模型特征

###### 趋势性：无

###### 相关性：有

###### 随机性：有

##### 三种模型的识别

### 3.非平稳的时间序列模型

常见的序列通常是非平稳的，我们需要通过一定方法将其变为平稳序列，再利用ARMA模型进行建模。
一定方法中即为差分


#### 时间序列中的差分运算

差分运算公式
B为滞后因子
- 一阶差分   
差分符x_t=x_t-x_{t-1}=(1-B)x_t
- 二阶差分
差分符^2x_t=差分符x_t-差分x_{t-1}=x_t-x_{t-1}-(x_{t-1}-x_{t-2})=(1-B)^2x_t
- 季节差分
- D阶季节差分

##### 差分会损失信息，一般两三次差分

#### ARIMA模型
I:Inegrated

各个参数
- AR：p (自回归）
- I：d （差分）
- MA：q （移动平均平均）

##### 在ARMA上发展来的，
脱战了ARMA模型的适用范围，
可处理原始为非平稳的序列。

###### 趋势性

###### 序列相关性

###### 随机性

##### 差分方式的选择

###### 1.序列蕴含着显著的线性趋势，一阶差分就可以实现趋势平稳

###### 2.序列蕴含着曲线趋势，通常低阶（二阶或者三阶）差
分可以提取处曲线趋势的影响，有时需要对序列做非线
性变换（如log变换）

###### 3.对于蕴含着固定周期的序列，可以进行步长为s（周
期长度）的差分运算（季节差分），通常能较好的提取
周期信息。

## 三 R操作

### ARMA模型查看

``` R
###### 4. ARMA(p,q)
### ARMA(1,1) AR = 0.8, MA = 0.7
rm("X")
p1 <- 0.8
q1 <- 0.7
set.seed(123456)
X <- arima.sim(list(order = c(1,0,1), ar = p1, ma = q1), n = nobs)
par(mfrow=c(2,2))
plot(X, type = 'p', xlab = "Time")
plot(X, type = 'l', xlab = "Time", ylab = "")
acf(X)
pacf(X)
     
### ARMA(1,1) AR = 0.8, MA = 0.7
p1 <- 0.6
q1 <- 0.5
     set.seed(123456)
     X <- arima.sim(list(order = c(1,0,1), ar = p1, ma = q1), n = nobs)
     plot(X, type = 'p', xlab = "Time")
     plot(X, type = 'l', xlab = "Time", ylab = "")
     acf(X)
     pacf(X)
     
     
     ### ARMA(2,2) AR = c(0.5, 0.4), MA = c(0.8, 0.6)
     p1 <- c(0.5, 0.4)
     q1 <- c(0.8, 0.6)
     set.seed(123456)
     X <- arima.sim(list(order = c(2,0,2), ar = p1, ma = q1), n = 1000)
     plot(X, type = 'p', xlab = "Time")
     plot(X, type = 'l', xlab = "Time", ylab = "")
     acf(X)
     pacf(X)
     
     
     ###### 5. ARIMA model(p,d,q)
     ### ARIMA(1,1,0) AR = 0.6
     set.seed(123456)
     X <- arima.sim(list(order = c(1,1,0),ar=0.6), n = 1000)
     X <- X[2:1001]
     par(mfrow=c(1,1))
     
     plot(X, type = 'l', xlab = "Time")
     acf(X)
     pacf(X)
     X.diff <- diff(X)
     plot(X.diff , type = 'l', xlab = "Time")
     acf(X.diff)
     pacf(X.diff)



```
